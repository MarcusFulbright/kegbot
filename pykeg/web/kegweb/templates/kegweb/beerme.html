{% extends "base.html" %}
{% block pagetitle %}
<h1>Beer Meh</h1>
{% endblock %}
{% block content %}
<style type="text/css">
body{
	background: whitesmoke;
	padding: 0;
}
/**, *:after, *:before {
	box-sizing: border-box;
}*/
.navbar {
	display: none;
}
.beer-me-asshole{
	background:#FA418B;
	border: 0;
	border-radius: 0;
	text-shadow: 0px 0px 0px transparent;
	height:100%;
	color:white;
	font-weight:bold;
	font-size:26px;
	position:relative;
	top: -15px;
	left: 15px;
	/*margin:-15px -15px 0 0;*/
	transition: all 200ms;
	padding: 15px;
	box-shadow:-1px 1px 0px black, 
				-2px 2px 0px black,
				-3px 3px 0px black,
				-4px 4px 0px black,
				-5px 5px 0px black,
				-6px 6px 0px black,
				-7px 7px 0px black,
				-8px 8px 0px black,
				-9px 9px 0px black,
				-10px 10px 0px black,
				-11px 11px 0px black,
				-12px 12px 0px black,
				-13px 13px 0px black,
				-14px 14px 0px black;
}
.beer-me-asshole:hover {
	position:relative;
	top: -10px;
	right: -10px;
	/*margin:-5px -5px 0 0;*/
	box-shadow:-1px 1px 0px black, 
				-2px 2px 0px black,
				-3px 3px 0px black,
				-4px 4px 0px black,
				-5px 5px 0px black,
				-6px 6px 0px black,
				-7px 7px 0px black,
				-8px 8px 0px black,
				-9px 9px 0px black,
				-10px 10px 0px black;
}
h1 {
	width:100%;
	text-align: center;
	text-transform: capitalize;
	font-size:130px;
	font-weight: 700;
	text-shadow:-1px 1px 0px #FA418B, 
				-2px 2px 0px #FA418B,
				-3px 3px 0px #FA418B,
				-4px 4px 0px #FA418B,
				-5px 5px 0px #FA418B,
				-6px 6px 0px #FA418B,
				-7px 7px 0px #FA418B,
				-8px 8px 0px #FA418B,
				-9px 9px 0px #FA418B,
				-10px 10px 0px #FA418B,
				-11px 11px 0px #FA418B,
				-12px 12px 0px #FA418B,
				-13px 13px 0px #FA418B,
				-14px 14px 0px #FA418B;
	padding:0 0 40px 0;

}
.drinkers, .taps{
		width:100%;
		padding:20px;
		background-color: white;
		border-radius: 0px;
		margin-bottom:100px;
		border:0;
		box-shadow:-1px 1px 0px #D4D4D4,
				-2px 2px 0px #D4D4D4,
				-3px 3px 0px #D4D4D4,
				-4px 4px 0px #D4D4D4,
				-5px 5px 0px #D4D4D4,
				-6px 6px 0px #D4D4D4,
				-7px 7px 0px #D4D4D4,
				-8px 8px 0px #D4D4D4,
				-9px 9px 0px #D4D4D4,
				-10px 10px 0px #D4D4D4,
				-11px 11px 0px #D4D4D4,
				-12px 12px 0px #D4D4D4,
				-13px 13px 0px #D4D4D4,
				-14px 14px 0px #D4D4D4,
				-15px 14px 0px #D4D4D4,
				-16px 16px 0px #D4D4D4,
				-17px 17px 0px #D4D4D4,
				-18px 18px 0px #D4D4D4,
				-19px 19px 0px #D4D4D4,
				-20px 20px 0px #D4D4D4,
				-21px 21px 0px #D4D4D4,
				-22px 22px 0px #D4D4D4,
				-23px 23px 0px #D4D4D4,
				-24px 24px 0px #D4D4D4,
				-25px 25px 0px #D4D4D4;
}
.drinkers:after, .taps:after, .meter:after, .tap:after, .volume:after{
	content: '';
	display:table;
	clear:both;
}
div#content{
	background-color:transparent;
	padding: 0px;
	border:0px !important;
	box-shadow:0 0 0 transparent;
}
h3 a{
	color: #FA418B;
	text-transform: capitalize;
	font-size:26px;
}
table {
	margin-left: 0 auto;
	width:100%;
}
table tr:nth-child(odd) td{
	background-color: whitesmoke;

}
table tr td{
		padding:30px;
}
.tap{
	width: 50%;
	box-sizing: border-box;
	height:400px;
	padding:10px;
	float: left;

}
.tap .meter {
	width:100%;
	height:100%;
	background: whitesmoke;
	position: relative;
	clear:both;
}
.tap .meter .measure {
	position:absolute;
	bottom: 0;
	width: 100%;
	height: 0%;
	background-color: #FA418B;
}
.tap .volume {
	position:absolute;
	top: 50%;
	width:100%;
	margin-top:-20px;
	font-weight: bold;
	text-align:center;
	font-size:28px;
	z-index:9000;
}
</style>
<script type="text/javascript">
	$(function(){

		var api_key = '1c8ddb8a328dfbbc7e45b9cf86c2fb1c';
		var urlKey = "?api_key=" + api_key;
		var postKey = { 'api_key': api_key };
		var url = '/api';
		var csrfmiddlewaretoken = $('.csrf input').val();
		var usertemplate = $('#usertemplate').html()
		var taptemplate = $('#taptemplate').html()



		/////////// get all our users ///////////////
		var users = $.ajax({
			'url': url + '/users/',
			'data': postKey,
			'type': 'GET',
		});
		var taps = $.ajax({
			'url': url + '/taps/',
			'data': postKey,
			'type': 'GET',
		});

		var handleUsers = function (data) {
			data.users = data.objects;
			drinksArray = [];
			$.each( data.users, function(i){
				var t = this;
				drinksArray[i] = $.ajax({
						'url': url + '/users/' + t.username + '/drinks',
						// 'data': data,
						'headers': {'X-CSRFToken': csrfmiddlewaretoken},
						'type': 'GET'
					});
			});

			var moarUserData = function() {

				$.each( arguments, function (i) {
					data.users[i].drinks = this[0].objects;
					data.users[i].volume_ml = 0;
					$.each( this[0].objects, function() {
						data.users[i].volume_ml += parseFloat(this.volume_ml.toFixed(1));
					});
				});
				$('.users').html( Mustache.to_html( usertemplate, data ) )
			}

			$.when.apply($, drinksArray ).then( moarUserData );


			$('body').on('click', '.beer-me-asshole', function(e) {
				e.preventDefault();
				var userUrl = $(this).attr('href');
				var data = postKey;

				data.username = $(this).data('username');

					setCurrentUser = $.ajax({
						'url': url + '/current_user/',
						'data': data,
						'headers': {'X-CSRFToken': csrfmiddlewaretoken},
						'type': 'POST',
						success: function(data) {
							console.log('data', data)
						}
					});
			});
		}
		// var handleTaps = function (data) {
		// 	data.taps = data.objects;
		// 	console.log('taps', data);
		// 	$.each(data.objects, function(i) {
		// 		if (this.current_keg != undefined){
		// 			this.current_keg.percent_full = this.current_keg.percent_full.toFixed(0) + '%';
		// 			this.notactive = false;
		// 		}else {
		// 			this.notactive = true;
		// 		}
		// 	});
		// 	$('.taps').html( Mustache.to_html( taptemplate, data ) )
			
		// }
		$.when( users ).then( handleUsers );
		// $.when( taps ).then( handleTaps );

	});
</script>
{% verbatim myblock %}
	<script id="usertemplate" type="text/mustache">
		<thead>
			<th align="left"><h2>Drinkers</h2></th>
			<th><h2>Drinks</h2></th>
			<th><h2>Volume</h2></th>
			<th></th>
		</thead>
		{{#users}}
			<tr>
				<td align="left">
					<h3><a href="{{ url }}">{{ username }}</a></h3>
				</td>
				<td align="center"><h3>{{ drinks.length }}</h3></td>
				<td align="center"><h3>~{{ volume_ml }}mL</h3></td>
				<td align="right">
					<a class="btn beer-me-asshole btn-alert" data-username="{{ username }}" href="{{ url }}">Beer Meh!</a>
				</td>
			</tr>
		{{/users}}
	</script>
	<!--
	<script id="taptemplate" type="text/mustache">
		{{#taps}}
			<div class="tap">
				<span class="tap-name"><h3>{{ name }} {{#notactive}}(Inactive){{/notactive}}</h3></span>
				<div class="meter">

				<span class="volume">{{ current_keg.percent_full }}</span>
					<div class="measure" style="height:{{ current_keg.percent_full }}%"></div>
				</div>
			</div>
		{{/taps}}
	</script>
-->
{% endverbatim myblock %}

<span class="csrf" style="display:none">{% csrf_token %}</span>
<div class="drinkers">
	<table class="users" align="center"></table>
</div>
<!-- <div class="taps">
</div> -->



{% endblock %}
